flowchart LR
  subgraph Host["ğŸ–¥ï¸ Host ãƒã‚·ãƒ³ï¼ˆWindowsï¼‰"]
    Bridge["ğŸ bridge.py - MQTT Subscriber<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>æ©Ÿèƒ½ï¼šMosquittoã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ã€Lambdaèµ·å‹•<br/>ãƒˆãƒ”ãƒƒã‚¯ï¼šsensor/data<br/>åœæ­¢ï¼šCtrl+Cã«ã‚ˆã‚‹ã‚¯ãƒªãƒ¼ãƒ³çµ‚äº†"]
    LocalStack["â˜ï¸ LocalStack<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼šhttp://localhost:4566<br/>æ©Ÿèƒ½ï¼šAWS Lambda ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œç’°å¢ƒã€Lambdaå®Ÿè¡Œæ™‚ã®ä¸€æ™‚ã‚³ãƒ³ãƒ†ãƒŠä½œæˆ"]
  end

  subgraph Docker["ğŸ³ Docker ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯"]
    Mosquitto["ğŸŒ Mosquitto Broker<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ãƒªã‚¹ãƒŠãƒ¼ãƒãƒ¼ãƒˆï¼š8883<br/>ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼šMQTT over TLS 1.2<br/>è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼šmosquitto.conf<br/>è¨¼æ˜æ›¸ï¼š./mosquitto-certs/"]
    Publisher["âš™ï¸ Publisher<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>è¨€èªï¼šCè¨€èªï¼ˆPaho MQTT Cï¼‰<br/>ãƒ“ãƒ«ãƒ‰ï¼šãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠåˆ©ç”¨<br/>å‡ºåŠ›ï¼špublisher_bin<br/>å‹•ä½œï¼š30ç§’é–“éš”ã§ã®é€ä¿¡ã€SIGINTã§ã®ã‚¯ãƒªãƒ¼ãƒ³çµ‚äº†ã€å†æ¥ç¶šå¯¾å¿œ"]
    Certs["ğŸ” TLSè¨¼æ˜æ›¸<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ca.crtï¼šCAè¨¼æ˜æ›¸<br/>server.crtï¼šã‚µãƒ¼ãƒè¨¼æ˜æ›¸<br/>server.keyï¼šç§˜å¯†éµ<br/>è‡ªå·±ç½²åè¨¼æ˜æ›¸ï¼ˆé–‹ç™ºç”¨ï¼‰"]
  end

  Publisher -->|MQTT publish<br/>ssl://host.docker.internal:8883<br/>TLS 1.2æš—å·åŒ–| Mosquitto
  Mosquitto -->|MQTT subscribe<br/>sensor/data<br/>JSONå½¢å¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸| Bridge
  Bridge -->|boto3 invoke<br/>FunctionName: iot_processor<br/>åŒæœŸå®Ÿè¡Œ| LocalStack
  Mosquitto -.->|è¨¼æ˜æ›¸å‚ç…§<br/>TLSé€šä¿¡ç”¨| Certs

  classDef hostfill fill:#ffb3de,stroke:#333,stroke-width:2px;
  classDef dockerfill fill:#b3d9ff,stroke:#333,stroke-width:2px;
  classDef secfill fill:#ffffb3,stroke:#333,stroke-width:2px;
  class Bridge,LocalStack hostfill;
  class Publisher,Mosquitto dockerfill;
  class Certs secfill;

  %% é‹ç”¨ãƒ¡ãƒ¢ãƒãƒ¼ãƒ‰ï¼ˆè¡¨ç¤ºç”¨ï¼‰
  Ops["ğŸ“‹ é‹ç”¨ãƒ¡ãƒ¢<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>ãƒ»Lambdaå®Ÿè¡Œå¾Œã®ä¸€æ™‚ã‚³ãƒ³ãƒ†ãƒŠã¯æ‰‹å‹•å‰Šé™¤ã¾ãŸã¯è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ¤œè¨<br/>ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è§£æ”¾æ™‚ã¯æ®‹å­˜ã‚³ãƒ³ãƒ†ãƒŠã®åœæ­¢ãƒ»å‰Šé™¤å®Ÿè¡Œ"]
  LocalStack --- Ops